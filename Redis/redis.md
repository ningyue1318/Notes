# NoSQL简介

1. 单机版本的MSQL

网站访问量不大的时候，用单个数据库完全可以应付

存储瓶颈

- 数据量的总大小一个机器放不下的时候
- 数据的索引一个机器放不下
- 访问能量一个实例不能承受



<img src="F:\学习资料\Nodes\Redis\resource\单机.png" style="zoom: 80%;" />

2. Memcached缓存+MySQL+垂直拆分

   随着访问量增加开始出现性能问题，通过文件缓存来缓解数据库的压力。

<img src="F:\学习资料\Nodes\Redis\resource\缓存.png" style="zoom:80%;" />

3. MySQL主从分离

   由于数据库写入压力大，Memcached只能缓解数据库读取压力，读写集中在一个数据库上压力太大，使用读写分离提高扩展性

<img src="F:\学习资料\Nodes\Redis\resource\主从分离.png" style="zoom:80%;" />

4. 分表分库+水平拆分+mysql集群

   随着数据写的压力瓶颈出现，开始使用集群解决

   <img src="F:\学习资料\Nodes\Redis\resource\集群.png" style="zoom:80%;" />

5. MySQL性能瓶颈

6. 现状

   <img src="F:\学习资料\Nodes\Redis\resource\现状.png" style="zoom:80%;" />

# NoSQL数据库的分类

<img src="F:\学习资料\Nodes\Redis\resource\4种NoSQL数据库.png" style="zoom:150%;" />

# 分布式数据库理论

## CAP

- 一致性（Consistency）：一致性说的是客户端的每次读操作，不管访问哪个节点，要么读到的都是同一份最新写入的数据，要么读取失败。

- 可用性（Availability）：可用性说的是任何来自客户端的请求，不管访问哪个非故障节点，都能得到响应数据，但不保证是同一份最新数据。这个指标强调的是服务可用，但不保证数据正确

- 分区容错性（Partition Tolerance）：当节点间出现任意数量的消息丢失或高延迟的时候，系统仍然在继续工作。也就是说，分布式系统在告诉访问本系统的客户端：不管我的内部出现什么样的数据同步问题，我会一直运行。这个指标，强调的是集群对分区故障的容错能力。

<img src="F:\学习资料\Nodes\Redis\resource\cap.png" style="zoom:80%;" />

- 当选择了一致性（C）的时候，一定会读到最新的数据，不会读到旧数据，但如果因为消息丢失、延迟过高发生了网络分区，那么这个时候，当集群节点接收到来自客户端的读请求时，为了不破坏一致性，可能会因为无法响应最新数据，而返回出错信息。
- 当选择了可用性（A）的时候，系统将始终处理客户端的查询，返回特定信息，如果发生了网络分区，一些节点将无法返回最新的特定信息，它们将返回自己当前的相对新的信息。

在不存在网络分区的情况下，也就是分布式系统正常运行时（这也是系统在绝大部分时候所处的状态），就是说在不需要 P 时，C 和 A 能够同时保证。只有当发生分区故障的时候，也就是说需要 P 时，才会在 C 和 A 之间做出选择。而且如果读操作会读到旧数据，影响到了系统运行或业务运行（也就是说会有负面的影响），推荐选择 C，否则选 A。

## CAP中追求一致性ACID

实现了ACID就是实现了事物，

分布式系统中使用两阶段提交协议来保证ACID

## CAP中追求可用性BASE

- 基本可用（Basically Available）
  1. 流量削峰：12306火车票在不同时间开售
  2. 延迟响应：买票排队等待一段时间才能买
  3. 体验降级：用小图片，低清晰度的图片代替原来的图片
  4. 过载保护：等待队列满了就剔除请求
- 最终一致性（Eventually consistent）
  1. 读时修复：在读取数据时，检测数据的不一致，进行修复
  2. 写时修复：在写入数据，检测数据的不一致时
  3. 异步修复：
- 软状态（Soft state）：一种过渡状态

# Redis常见数据结构